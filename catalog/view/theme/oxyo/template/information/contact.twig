{{ header }}
{#
{% if oxyo_map_lat and oxyo_map_lon and oxyo_map_style == "full_width" %}
<div id="gmap" class="map-full-width">
    <div class="address-holder col-sm-5 col-md-4 col-lg-3">
        <h3 class="contrast-heading">{{ store }}</h3>
        <p>{{ address }}</p>
        <a class="uline_link to_form">{{ heading_title }}</a>
    </div>
</div>
{% endif %}
#}
{% set contact_form_wrapper = '</div><div class="col-12 col-md-6 right-side">' %}
{% set contact_form_wrapper_end = '</div></div>' %}
{% if oxyo_map_style and oxyo_yandex_map != '' %}
    {% set contact_form_wrapper = '<div class="mt-3">' %}
    {% set contact_form_wrapper_end = '</div>' %}
{% endif %}

<div class="container">
    <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
    </ul>

    <div class="row">
        {#
        {% if oxyo_map_lat and oxyo_map_lon and oxyo_map_style == "inline" %}
        <div id="gmap" class="col-sm-12 map-inline"></div>
        {% endif %}
        #}

        {{ column_left }}

        {% if column_left and column_right %}
            {% set class = 'col-sm-6' %}
        {% elseif column_left or column_right %}
            {% set class = 'col-md-9 col-sm-8' %}
        {% else %}
            {% set class = 'col-sm-12' %}
        {% endif %}

        <div id="content" class="{{ class }}">
            {{ content_top }}

            <div class="row">
                <div class="col-12 col-md-6 left-side">
                    <h1 id="page-title">{{ heading_title }}</h1>

                    {% if image %}
                    <div class="contact-image margin-b25 d-none hidden">
                        <img src="{{ image }}" alt="{{ store }}" title="{{ store }}">
                    </div>
                    {% endif %}

                    {% if contact_array is defined %}

                        {% set contact_lines = ['main_address','directions','working_hours','main_phone','main_email','callback'] %}
                        {% set contact_icons = ['max','whatsapp','telegram','vkontakte','avito','instagram','tiktok'] %}

                        <ul class="info-lines">
                            {% for contact in contact_array %}
                                {% set flags = contact.contact_flags|default({}) %}
                                {% set show_contact = contact.value and (flags.xs or flags.md or flags.lg or flags.xl) %}
                                {% if show_contact and contact.name in contact_lines %}
                                <li class="{{ contact.contact_class|default('') }}">
                                    {% if contact.link %}
                                        <a href="{{ contact.link }}" class="contact-item info-line" target="_blank" {% if contact.onclick %}onclick="{{ contact.onclick }}"{% endif %}>{% if contact.icon_svg %}{{ contact.icon_svg|raw }}{% elseif contact.icon %}{{ contact.icon|raw }}{% endif %}{{ contact.value }}</a>
                                    {% else %}
                                        <span class="contact-item info-line" {% if contact.onclick %}onclick="{{ contact.onclick }}"{% endif %}>{% if contact.icon_svg %}{{ contact.icon_svg|raw }}{% elseif contact.icon %}{{ contact.icon|raw }}{% endif %}{{ contact.value }}</span>
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>

                        <ul class="info-icons">
                            {% for contact in contact_array %}
                                {% set flags = contact.contact_flags|default({}) %}
                                {% set show_contact = contact.value and (flags.xs or flags.md or flags.lg or flags.xl) %}
                                {% if show_contact and contact.name in contact_icons %}
                                <li class="{{ contact.contact_class|default('') }}">
                                    {% if contact.link %}
                                        <a href="{{ contact.link }}" class="contact-item info-icon" target="_blank" {% if contact.onclick %}onclick="{{ contact.onclick }}"{% endif %}>{% if contact.icon %}{{ contact.icon|raw }}{% elseif contact.icon_svg %}{{ contact.icon_svg|raw }}{% endif %}</a>
                                    {% else %}
                                        <span class="contact-item info-icon" {% if contact.onclick %}onclick="{{ contact.onclick }}"{% endif %}>{% if contact.icon %}{{ contact.icon|raw }}{% elseif contact.icon_svg %}{{ contact.icon_svg|raw }}{% endif %}</span>
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    {% endif %}
                    {% if contact_form %}
                        {{ contact_form_wrapper|raw }}
                            <h3 class="lined-title d-none hidden"><span><b>{{ text_contact }}</b></span></h3>
                            <form action="{{ action }}" method="post" enctype="multipart/form-data" class="form-vertical">
                                <div class="row">
                                    <div class="form-group col-sm-6 required">
                                        <label for="input-name">{{ entry_name }}</label>
                                        <input type="text" name="name" value="{{ name }}" id="input-name" class="form-control">
                                        {% if error_name %}
                                            <div class="text-danger">{{ error_name }}</div>
                                        {% endif %}
                                    </div>

                                    <div class="form-group col-sm-6 required">
                                        <label for="input-email">{{ entry_email }}</label>
                                        <input type="text" name="email" value="{{ email }}" id="input-email" class="form-control">
                                        {% if error_email %}
                                            <div class="text-danger">{{ error_email }}</div>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="form-group required">
                                    <label for="input-enquiry">{{ entry_enquiry }}</label>
                                    <textarea name="enquiry" rows="10" id="input-enquiry" class="form-control">{{ enquiry }}</textarea>
                                    {% if error_enquiry %}
                                        <div class="text-danger">{{ error_enquiry }}</div>
                                    {% endif %}
                                </div>

                                {% if contact_agree_status %}
                                    <div class="form-group required">
                                        <div class="form-check">
                                            <input type="checkbox" name="agreement" value="1" id="input-agreement" />
                                            <label for="input-agreement">{{ entry_agreement }}</label>
                                        </div>
                                        {% if error_agreement %}
                                            <div class="text-danger">{{ error_agreement }}</div>
                                        {% endif %}
                                    </div>                      
                                {% endif %}      

                                {{ captcha }}

                                <div class="form-group margin-b50">
                                    <input class="btn btn-contrast" type="submit" value="{{ button_submit }}">
                                </div>
                            </form>
                        {{ contact_form_wrapper_end|raw }}
                    {% endif %}
                </div>

                {% if oxyo_map_style and oxyo_yandex_map != '' %}
                    <div class="col-12 col-md-6 right-side">
                        {#
                        {% if comment %}
                        <div class="margin-b45">
                            <h3 class="lined-title lg margin-b20"><span><b>{{ text_comment }}</b></span></h3>
                            {{ comment }}
                        </div>
                        {% endif %}

                        {% if locations %}
                            <h3 class="lined-title lg margin-b15"><span><b>{{ text_store }}</b></span></h3>

                            <div class="panel-group" id="accordion">
                                {% for location in locations %}
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            <a href="#collapse-location{{ location.location_id }}" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion">{{ location.name }} <i class="fa fa-caret-down"></i></a>
                                        </h4>
                                    </div>

                                    <div class="panel-collapse collapse" id="collapse-location{{ location.location_id }}">
                                        <div class="panel-body">

                                            {% if location.image %}
                                            <div class="contact-image margin-b25">
                                                <img src="{{ location.image }}" alt="{{ location.name }}" title="{{ location.name }}">
                                            </div>
                                            {% endif %}

                                            {% if location.comment %}
                                                <b>{{ text_comment }}</b><br>{{ location.comment }}<br><br><br>
                                            {% endif %}

                                            <div class="grid-holder margin-b20">

                                                <div class="item">
                                                    <p class="contact-detail">
                                                        <i class="icon-cursor icon"></i>
                                                        {{ location.name }}<br>{{ location.address }}
                                                        {% if location.geocode %}
                                                            <br>
                                                            <a href="https://maps.google.com/maps?q={{ location.geocode|url_encode }}&hl={{ geocode_hl }}&t=m&z=15" target="_blank" class="btn btn-info"><i class="fa fa-map-marker"></i> {{ button_map }}</a>
                                                        {% endif %}
                                                    </p>
                                                </div>

                                                <div class="item">
                                                    <p class="contact-detail">
                                                        <i class="icon-phone icon"></i>
                                                        {{ location.telephone }}
                                                        {% if location.fax %}<br>{{ text_fax }}: {{ location.fax }}{% endif %}
                                                    </p>
                                                </div>

                                                {% if location.open %}
                                                <div class="item">
                                                    <p class="contact-detail">
                                                        <i class="icon-clock icon"></i>
                                                        {{ location.open }}
                                                    </p>
                                                </div>
                                                {% endif %}

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>

                        {% endif %}
                        #}
                        <div class="yandex-map-container {{ oxyo_map_style }}">
                            {{ oxyo_yandex_map|raw }}
                        </div>
                    </div>
                {% endif %}
            </div>

            {{ content_bottom }}
        </div>

        {{ column_right }}
    </div>
</div>
{#
{% if oxyo_map_style %}
<script>
$(document).ready(function() {
    new Maplace({
        locations: [{ lat: {{ oxyo_map_lat }}, lon: {{ oxyo_map_lon }} }],
        controls_on_map: true,
        start: 1,
        map_options: { zoom: 15, scrollwheel: false }
    }).Load();

    {% if oxyo_map_lat and oxyo_map_lon and oxyo_map_style == "full_width" %}
        $('body').addClass('full-width-map');
    {% endif %}
});
</script>
{% endif %}

<script>
$(document).ready(function() {
    $(".to_form").click(function() {
        $('html, body').animate({ scrollTop: ($(".form-vertical").offset().top - 200) }, 1000);
    });
});
</script>
#}

<script>
document.addEventListener('DOMContentLoaded', function () {

    function resizeYandexIframe() {
        var left = document.querySelector('.left-side');
        var iframe = document.querySelector('.yandex-map-container iframe');

        if (!left || !iframe) {
            return;
        }

        // Remember current height (если вдруг надо откатиться)
        var oldHeight = iframe.style.height;

        // Temporarily collapse iframe so it does not affect row height
        iframe.style.height = '0px';

        // Force reflow and get "clean" left-side height
        var leftHeight = left.offsetHeight;

        // Set iframe height to left column height (fallback — старое значение или 720)
        if (leftHeight > 0) {
            iframe.style.height = leftHeight + 'px';
        } else {
            iframe.style.height = oldHeight || '720px';
        }
    }

    // Initial
    resizeYandexIframe();

    // After full load (картинки, шрифты и т.д.)
    window.addEventListener('load', resizeYandexIframe);

    // On resize
    window.addEventListener('resize', resizeYandexIframe);
});
</script>


{{ footer }}
